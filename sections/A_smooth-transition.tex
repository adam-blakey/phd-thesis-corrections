\chapter{Details on the smooth transition function} \label{sec:smooth-transition}    
    To mathematically define an expression for $\Psi(\vec{x})$ in \S\ref{sec:modelling:blood-flow}, we first introduce some auxiliary variables. The simple idea here is that we assign $\Psi = 1$ in areas of villous tree and $\Psi = 0$ in areas of no villous tree.    
    
    The central cavity is defined by half an ellipse (a semi-ellipse) with a semi-minor axis of $a_1$ and a semi-major axis of $b_1$, where $2a_1 = b_1$ with $a_1$ denoting the semi-axis that is tangential to the basal plate. We then add two more ellipses at equal distances inside and outside the first ellipse, which acts as a transition region. We introduce a smooth transition function defined as
    \begin{equation}
        \beta_{s_0,s_1,s_2}(s) := 
        \begin{cases}
            0 & \text{if } 0 \leq s < s_0, \\
            \frac{1}{2}\left[ \frac{\tanh(\gamma\left\{ \frac{s-s_1}{s_2-s_1} \right\})}{\tanh(\gamma)} + 1 \right], & \text{if } s_0 \leq s \leq s_2, \\
            1 & \text{if } s_2 < s, \\
        \end{cases}
    \end{equation}
    where $s_2 - s_0$ gives the transition width, and we assume the relation $s_1 \equiv \frac{s_0 + s_2}{2}$. We note that $\beta$ differs from $\tanh$, as $\tanh$ has asymptotes at $\pm 1$, whereas $\beta$ has no such asymptotes; $\beta$ instead attains maximum and minimum values by taking a `cut-off' value, parameterised by $\gamma$, outside which $\beta$ attains its extrema. We note that the scaling $\gamma$ is included so that $\beta$ is continuous everywhere, and is fixed $\gamma = 0.999$. These differences are illustrated in Figure \ref{fig:transition:beta}.

    \begin{figure}
        \begin{subfigure}[b]{0.45\textwidth}
            \centering
            \input{diagrams/placenta-geometry-diagrams/transition-beta}
            \caption{}
            \label{fig:transition:beta}
        \end{subfigure}
        \hfill
        \begin{subfigure}[b]{0.45\textwidth}
            \centering
            \input{diagrams/placenta-geometry-diagrams/transition-slice}
            \caption{}
            \label{fig:transition:slice}
        \end{subfigure}
        \caption{(a) Curve of $\beta(s)$ in relation to $s_0$, $s_1$, and $s_2$. (b) Curve showing a slice of $\Psi$ on a placentone along $y = 0$ (i.e. on the basal plate) at the bottom of the cavity region, where $a_0$, $a_1$, and $a_2$ respectively denote the semi-minor axes of the inner, centre, and outer ellipses.}
        \label{fig:transition}
    \end{figure}

    The ellipses which form the geometry of the smooth transition region at the boundary of the central cavity are defined by
    \begin{align}
        \begin{split}
            r_0(\theta) & := \frac{a_0 b_0}{\sqrt{a_0^2 \sin^2(\theta) + b_0^2 \cos^2(\theta)}},
        \end{split}\\
        \begin{split}
            r_1(\theta) & := \frac{a_1 b_1}{\sqrt{a_1^2 \sin^2(\theta) + b_1^2 \cos^2(\theta)}},
        \end{split}\\
        \begin{split}
            r_2(\theta) & := \frac{a_2 b_2}{\sqrt{a_2^2 \sin^2(\theta) + b_2^2 \cos^2(\theta)}},
        \end{split}
    \end{align}
    where $\vec{x} \equiv (x, y)^\intercal$ are 2D Cartesian coordinates, and
    \begin{align}
        \begin{split}
            \theta(\vec{x}) & := \arctan{\left(\frac{y-c_2}{x-c_1}\right)},
        \end{split}\\
        \begin{split}
            r(\vec{x}) & := \sqrt{(\vec{x} - \vec{c}) \cdot (\vec{x} - \vec{c})}
        \end{split}
    \end{align}
    are 2D polar coordinates with $r = 0$ at $\vec{c} \equiv (c_1, c_2)^\intercal$ and $\theta = 0$ is tangential to the interface between $\Omega_\text{CC}$ and $\Omega_\text{a}$ (pointing in the anticlockwise direction). Here, $\vec{c}$ is the point at the centre of where an artery meets the placenta. The transition width, $\tau$, is defined such that $\tau = a_2 - a_0$ and $2\tau = b_2 - b_0$. The transition region in the central cavity is illustrated in Figure \ref{fig:transition-sizes:cavity}.

    \begin{figure}
        \begin{subfigure}[b]{0.45\textwidth}
            \centering
            \input{diagrams/placenta-geometry-diagrams/cavity-sizing}
            \caption{}
            \label{fig:transition-sizes:cavity}
        \end{subfigure}
        \hfill
        \begin{subfigure}[b]{0.45\textwidth}
            \centering
            \input{diagrams/placenta-geometry-diagrams/vein-sizing}
            \caption{}
            \label{fig:transition-sizes:vein}
        \end{subfigure}
        \caption{(a) Illustrates the semi-minor and semi-major axes defined in Appendix \ref{sec:smooth-transition} for the central cavity transition, including the marked point at the top of the centre of the inlet artery. (b) Illustrates parameters used in defining the smooth transition over the outlet veins.}
        \label{fig:transition-sizes}
    \end{figure}

    The smooth transition regions in the veins are defined using
    \begin{equation*}
        m(\vec{x}) := (\vec{x} - \vec{c}) \cdot \hat{\vec{n}},
    \end{equation*}
    where $\hat{\vec{n}} := \vec{n}/|\vec{n}|$, $\vec{n} = \vec{c} - \vec{p}$, and $\vec{p} \equiv (p_1, p_2)^\intercal$ is the centre of the large circle that traces out the curve on the basal plate. Here, $\vec{c}$ is the point at the centre of where a vein meets the placenta.

    The coefficient $\Psi$ is then given as
    \begin{equation}
        \Psi(\vec{x}) := 
        \begin{cases}
            0, & \text{if } \vec{x} \in \Omega_\text{a} \cup \Omega_\text{CC}, \\
            \beta_{r_0,r_1,r_2}(r(\vec{x})), & \text{if } \vec{x} \in \Omega_{\text{T}^-} \cup \Omega_{\text{T}^+}, \\
            \beta_{y_0,y_1,y_2}(m(\vec{x})), & \text{if } \vec{x} \in \Omega_\text{v}, \\
            1, & \text{if } \vec{x} \in \Omega_\text{IVS}, \\
        \end{cases}
        \label{eq:smooth-transition}
    \end{equation}
    where $y_2 - y_0$ is chosen to give a transition region in the veins with $y_1 \equiv \frac{y_0 + y_2}{2}$, which are shown in Figure \ref{fig:transition-sizes:vein}. A slice of $\Psi(\vec{x})$ on the placentone geometry along $y = 0$ is illustrated in Figure \ref{fig:transition:slice}.
    